<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Reece Holland</title><meta name=keywords content><meta name=description content="Moving to micro-ROS with Teensy 4.1
Why Switch?
After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless."><meta name=author content><link rel=canonical href=https://reeceholland.github.io/posts/teensy-integration/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://reeceholland.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://reeceholland.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://reeceholland.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://reeceholland.github.io/apple-touch-icon.png><link rel=mask-icon href=https://reeceholland.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://reeceholland.github.io/posts/teensy-integration/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://reeceholland.github.io/posts/teensy-integration/"><meta property="og:site_name" content="Reece Holland"><meta property="og:title" content="Reece Holland"><meta property="og:description" content="Moving to micro-ROS with Teensy 4.1 Why Switch? After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Moving to micro-ROS with Teensy 4.1
Why Switch?
After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://reeceholland.github.io/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://reeceholland.github.io/posts/teensy-integration/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"Moving to micro-ROS with Teensy 4.1 Why Switch? After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless.\n","keywords":[],"articleBody":"Moving to micro-ROS with Teensy 4.1 Why Switch? After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless.\nGetting micro-ROS to Compile on Teensy The upgrade wasn’t plug-and-play. Right out of the gate, the micro-ROS Arduino library wouldn’t build for Teensy 4.1. Most of the issues were related to how Arduino IDE and Teensyduino handle precompiled libraries.\nThe fix:\nInstall the Teensyduino library version 1.57.3 if you’re using Arduino IDE 2.0.4 or later. Follow the workaround from this PJRC forum post which explains how to patch Teensy’s build scripts to support precompiled static libraries (required for micro-ROS). Once these changes were in, the micro-ROS basic publisher example compiled and uploaded without error.\nConnection Stability Compiling is only half the battle—getting a reliable connection to the micro-ROS agent can still be a struggle. The Teensy node sometimes drops out or fails to reconnect, especially after resets. The example code from the micro-ROS repo uses a simple state machine to attempt reconnection, which is a great starting point:\nswitch (state) { case WAITING_AGENT: // Try to ping agent break; case AGENT_AVAILABLE: // Attempt entity creation break; case AGENT_CONNECTED: // Run executor break; case AGENT_DISCONNECTED: // Clean up and retry break; } This approach helps but isn’t flawless; occasional dropouts still happen and need manual intervention. It’s something to keep iterating on.\nNext Steps Extend the micro-ROS node to publish actual rover sensor data (encoders, battery voltage) and subscribe to velocity commands from ROS 2.\nWork on making the connection more robust—potentially by tweaking timeouts, retry intervals, or agent serial settings.\nMigrate the rest of the hardware driver logic over to micro-ROS to take full advantage of native ROS integration.\nFinal Thoughts The move to Teensy 4.1 and micro-ROS is a big leap forward for the rugged rover project. The process can be bumpy, especially with micro-ROS’s current build system, but it’s absolutely possible with the right combination of tools and workarounds.\nIf anyone else is attempting micro-ROS on Teensy and hits a roadblock, I highly recommend checking the PJRC forums for up-to-date solutions.\n","wordCount":"394","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://reeceholland.github.io/posts/teensy-integration/"},"publisher":{"@type":"Organization","name":"Reece Holland","logo":{"@type":"ImageObject","url":"https://reeceholland.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://reeceholland.github.io/ accesskey=h title="Reece Holland (Alt + H)">Reece Holland</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://reeceholland.github.io/about/ title=About><span>About</span></a></li><li><a href=https://reeceholland.github.io/posts/ title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent"></h1><div class=post-meta></div></header><div class=post-content><h1 id=moving-to-micro-ros-with-teensy-41>Moving to micro-ROS with Teensy 4.1<a hidden class=anchor aria-hidden=true href=#moving-to-micro-ros-with-teensy-41>#</a></h1><h2 id=why-switch>Why Switch?<a hidden class=anchor aria-hidden=true href=#why-switch>#</a></h2><p>After working with the Arduino Mega for the rover’s low-level control, I wanted something that could handle more direct ROS integration. The Teensy 4.1 brings more processing power and plenty of headroom for future features. With micro-ROS, the microcontroller is no longer just a “dumb” serial device—it becomes a true ROS 2 node, making everything from feedback to firmware updates much more seamless.</p><h2 id=getting-micro-ros-to-compile-on-teensy>Getting micro-ROS to Compile on Teensy<a hidden class=anchor aria-hidden=true href=#getting-micro-ros-to-compile-on-teensy>#</a></h2><p>The upgrade wasn’t plug-and-play. Right out of the gate, the micro-ROS Arduino library wouldn’t build for Teensy 4.1. Most of the issues were related to how Arduino IDE and Teensyduino handle precompiled libraries.</p><p><strong>The fix:</strong></p><ul><li>Install the Teensyduino library version 1.57.3 if you’re using Arduino IDE 2.0.4 or later.</li><li>Follow the workaround from <a href=https://forum.pjrc.com/index.php?threads/solution-for-adding-support-for-pre-compiled-libraries.63256/>this PJRC forum post</a> which explains how to patch Teensy’s build scripts to support precompiled static libraries (required for micro-ROS).</li></ul><p>Once these changes were in, the micro-ROS basic publisher example compiled and uploaded without error.</p><h2 id=connection-stability>Connection Stability<a hidden class=anchor aria-hidden=true href=#connection-stability>#</a></h2><p>Compiling is only half the battle—getting a reliable connection to the micro-ROS agent can still be a struggle. The Teensy node sometimes drops out or fails to reconnect, especially after resets. The example code from the micro-ROS repo uses a simple state machine to attempt reconnection, which is a great starting point:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>switch</span> (state) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> WAITING_AGENT:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Try to ping agent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> AGENT_AVAILABLE:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Attempt entity creation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> AGENT_CONNECTED:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Run executor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> AGENT_DISCONNECTED:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clean up and retry
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This approach helps but isn’t flawless; occasional dropouts still happen and need manual intervention. It’s something to keep iterating on.</p><h2 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h2><p>Extend the micro-ROS node to publish actual rover sensor data (encoders, battery voltage) and subscribe to velocity commands from ROS 2.</p><p>Work on making the connection more robust—potentially by tweaking timeouts, retry intervals, or agent serial settings.</p><p>Migrate the rest of the hardware driver logic over to micro-ROS to take full advantage of native ROS integration.</p><h2 id=final-thoughts>Final Thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h2><p>The move to Teensy 4.1 and micro-ROS is a big leap forward for the rugged rover project. The process can be bumpy, especially with micro-ROS’s current build system, but it’s absolutely possible with the right combination of tools and workarounds.</p><p>If anyone else is attempting micro-ROS on Teensy and hits a roadblock, I highly recommend checking the PJRC forums for up-to-date solutions.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://reeceholland.github.io/>Reece Holland</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>